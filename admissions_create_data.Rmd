title: "Admissions dataset generation"
author: "Jacqueline Gutman, Suvam Paul"
date: 'Last updated: `r format(Sys.Date(), "%B %d, %Y") ` '
output:
  html_document:
    toc: yes
    toc_depth: '4'
  html_notebook:
    highlight: tango
    theme: cosmo
    toc: yes
    toc_depth: 4
---

```{r, message = FALSE}
library(tidyverse)
library(magrittr)
library(knitr)
opts_chunk$set(message = FALSE, warning = FALSE, comment = "   ",
               cache = TRUE, autodep = TRUE, cache.comments = FALSE)

# list.dirs("/Volumes/", full.names = FALSE, recursive = FALSE)
admissions_path <- "/Volumes/IIME/EDS/data/admissions"
(raw_files <- list.files(admissions_path, full.names = TRUE))
```

```{r, message = FALSE}
extract_data <- function(file_list, keyword) {
  data <- file_list %>%
    stringr::str_detect(keyword) %>%
    which() %>%
    extract2(file_list, .) %>%
    read_csv() %>%
    set_colnames(tolower(colnames(.)))
}

applications <- raw_files %>%
  extract_data("application") %>%
  select(-first_name, -last_name)

applications
```

```{r}
applications %>%
  filter(program_name == "Regular M.D.") %>%
  group_by(appl_year, application_status) %>%
  summarize(count = n()) %>%
  spread(application_status, count, fill = 0)
```

```{r, message = FALSE}
mcat_old <- raw_files %>% 
  extract_data("/mcat") %>%
  set_colnames(stringr::str_replace(colnames(.), "_p$", "_percentile"))

mcat_new <- raw_files %>% 
  extract_data("new_mcat")
```

